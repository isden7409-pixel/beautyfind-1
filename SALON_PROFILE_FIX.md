# Исправление проблемы "Salon profile not found"

## Проблема
После регистрации салона при входе в профиль показывалось сообщение "Salon profile not found".

## Причина
Система искала салон по email пользователя, но email в профиле пользователя мог отличаться от email салона, указанного при регистрации.

## Решение
Внесены следующие изменения:

### 1. Добавлено поле `ownerId` в салоны
- Каждый салон теперь связывается с пользователем через уникальный `ownerId` (uid пользователя)
- Это обеспечивает надёжную связь между аккаунтом и салоном

### 2. Обновлён процесс создания салона
- При создании салона автоматически добавляется `ownerId` текущего пользователя
- В профиль пользователя добавляется `salonId` созданного салона

### 3. Обновлён процесс загрузки профиля салона
- Сначала ищется салон по `ownerId` (новый подход)
- Если не найден - ищется по email (для обратной совместимости)

### 4. Добавлена утилита миграции
- Автоматически связывает существующие салоны с их владельцами
- Доступна через панель администратора

## Как исправить существующий салон

### Вариант 1: Через интерфейс (рекомендуется)
1. Откройте приложение в браузере
2. Перейдите в раздел "Admin Panel" (Административная панель)
3. Вверху страницы вы увидите блок "Миграция данных" / "Data Migration"
4. Нажмите кнопку "Запустить миграцию" / "Run Migration"
5. Дождитесь завершения процесса
6. Проверьте результаты миграции
7. Попробуйте войти в профиль салона снова

### Вариант 2: Через консоль браузера
1. Откройте консоль разработчика (F12)
2. Выполните следующие команды:
```javascript
// Импортируем функцию миграции
import { runMigration } from './utils/migrateSalons';

// Запускаем миграцию
runMigration().then(results => {
  console.log('Миграция завершена:', results);
});
```

## Для новых салонов
Для новых салонов никаких дополнительных действий не требуется. Связь между пользователем и салоном создаётся автоматически при регистрации.

## Изменённые файлы
- `src/types/index.ts` - добавлено поле `ownerId` в интерфейс `Salon`
- `src/firebase/services.ts` - обновлён метод создания салона
- `src/components/SalonRegistrationForm.tsx` - добавлена передача `ownerId` при создании
- `src/pages/dashboards/SalonDashboard.tsx` - обновлён поиск салона
- `src/utils/migrateSalons.ts` - утилита для миграции существующих данных
- `src/components/MigrationPanel.tsx` - UI для запуска миграции
- `src/pages/AdminPanel.tsx` - добавлена панель миграции

## Техническая информация

### Структура данных

**Коллекция `users`:**
```typescript
{
  uid: string,
  email: string,
  type: 'salon' | 'master' | 'client',
  salonId?: string  // ID салона (новое поле)
}
```

**Коллекция `salons`:**
```typescript
{
  id: string,
  email: string,
  name: string,
  ownerId?: string  // uid владельца (новое поле)
  // ... другие поля
}
```

### Алгоритм поиска салона
```typescript
1. Поиск по ownerId (userProfile.uid)
2. Если не найден → поиск по email (для старых салонов)
3. Если найден → отображение профиля
4. Если не найден → показать "Salon profile not found"
```

## Дополнительно
Если после миграции проблема сохраняется, проверьте:
1. Что пользователь зарегистрирован с типом 'salon'
2. Что в базе данных есть салон с соответствующим email
3. Логи консоли для дополнительной информации об ошибках


















