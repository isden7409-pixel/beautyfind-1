#!/bin/bash

# ============================================================================
# –°–ö–†–ò–ü–¢ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø –°–ò–°–¢–ï–ú–´ –†–ï–ó–ï–†–í–ê–¶–ò–ò BEAUTYFIND
# ============================================================================
# 
# –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç –∏ —Ä–∞–∑–≤–µ—Ä–Ω–µ—Ç —Å–∏—Å—Ç–µ–º—É —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏
# –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∑–∞–º–µ–Ω–∏—Ç–µ YOUR_EMAIL –∏ YOUR_PASSWORD –Ω–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ!
#
# ============================================================================

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏ BeautyFind..."
echo ""

# ============================================================================
# –®–ê–ì 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# ============================================================================
echo "üì¶ –®–∞–≥ 1/4: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Functions..."
cd functions
npm install
if [ $? -eq 0 ]; then
    echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
else
    echo "‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π!"
    exit 1
fi
cd ..
echo ""

# ============================================================================
# –®–ê–ì 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email (–ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ò –î–ê–ù–ù–´–ï!)
# ============================================================================
echo "üìß –®–∞–≥ 2/4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ email –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
echo "‚ö†Ô∏è  –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_EMAIL –∏ YOUR_PASSWORD –Ω–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ!"
echo ""

# –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –ó–ù–ê–ß–ï–ù–ò–Ø –ù–ê –°–í–û–ò:
EMAIL_USER="YOUR_EMAIL@gmail.com"
EMAIL_PASSWORD="YOUR_APP_PASSWORD"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–º–µ–Ω–µ–Ω—ã
if [ "$EMAIL_USER" = "YOUR_EMAIL@gmail.com" ]; then
    echo "‚ùå –û–®–ò–ë–ö–ê: –í—ã –Ω–µ –∑–∞–º–µ–Ω–∏–ª–∏ YOUR_EMAIL –Ω–∞ —Å–≤–æ–π email!"
    echo "   –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –ö–û–ú–ê–ù–î–´_–î–õ–Ø_–ó–ê–ü–£–°–ö–ê.sh –∏ –∑–∞–º–µ–Ω–∏—Ç–µ:"
    echo "   EMAIL_USER=\"YOUR_EMAIL@gmail.com\""
    echo "   –Ω–∞"
    echo "   EMAIL_USER=\"–≤–∞—à-–Ω–∞—Å—Ç–æ—è—â–∏–π-email@gmail.com\""
    exit 1
fi

firebase functions:config:set email.user="$EMAIL_USER"
firebase functions:config:set email.password="$EMAIL_PASSWORD"

if [ $? -eq 0 ]; then
    echo "‚úÖ Email –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ email!"
    exit 1
fi
echo ""

# ============================================================================
# –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
# ============================================================================
echo "üîç –®–∞–≥ 3/4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
firebase functions:config:get
echo ""

# ============================================================================
# –®–ê–ì 4: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Functions –∏ Rules
# ============================================================================
echo "üöÄ –®–∞–≥ 4/4: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Functions –∏ Firestore Rules..."
echo "   –≠—Ç–æ –∑–∞–π–º–µ—Ç ~5 –º–∏–Ω—É—Ç. –ü–æ–¥–æ–∂–¥–∏—Ç–µ..."
echo ""

firebase deploy --only functions,firestore:rules

if [ $? -eq 0 ]; then
    echo ""
    echo "============================================"
    echo "üéâ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û!"
    echo "============================================"
    echo ""
    echo "‚úÖ –†–∞–∑–≤–µ—Ä–Ω—É—Ç–æ:"
    echo "   - 5 Cloud Functions"
    echo "   - Firestore Security Rules"
    echo ""
    echo "üìß Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç!"
    echo "ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞!"
    echo ""
    echo "üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
    echo "   1. –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç"
    echo "   2. –ó–∞–π—Ç–∏ –≤ –¥–∞—à–±–æ—Ä–¥ —Å–∞–ª–æ–Ω–∞/–º–∞—Å—Ç–µ—Ä–∞"
    echo "   3. –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥–∏ (–≤–∫–ª–∞–¥–∫–∞ Na≈°e slu≈æby / Moje slu≈æby)"
    echo "   4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–≤–∫–ª–∞–¥–∫–∞ Rozvrh)"
    echo "   5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é!"
    echo ""
    echo "üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:"
    echo "   - –ë–´–°–¢–†–´–ô_–°–¢–ê–†–¢.md"
    echo "   - FIREBASE_SETUP_–ò–ù–°–¢–†–£–ö–¶–ò–Ø.md"
    echo "   - ‚úÖ_–°–ò–°–¢–ï–ú–ê_–†–ï–ó–ï–†–í–ê–¶–ò–ò_100%_–ì–û–¢–û–í–ê.md"
    echo ""
    echo "üöÄ –°–ò–°–¢–ï–ú–ê –†–ï–ó–ï–†–í–ê–¶–ò–ò –ì–û–¢–û–í–ê –ö –†–ê–ë–û–¢–ï!"
    echo "============================================"
else
    echo ""
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏!"
    echo ""
    echo "–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:"
    echo "1. –ù–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω Blaze Plan (–Ω—É–∂–µ–Ω –¥–ª—è Functions)"
    echo "2. –ù–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ Firebase –ø—Ä–æ–µ–∫—Ç—É"
    echo "3. –ù–µ–≤–µ—Ä–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è email"
    echo ""
    echo "–†–µ—à–µ–Ω–∏–µ:"
    echo "1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Blaze Plan –≤ Firebase Console"
    echo "2. –í–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ: firebase login --reauth"
    echo "3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å email: firebase functions:config:get"
    echo ""
    echo "üìö –ß–∏—Ç–∞–π: FIREBASE_SETUP_–ò–ù–°–¢–†–£–ö–¶–ò–Ø.md"
    exit 1
fi




